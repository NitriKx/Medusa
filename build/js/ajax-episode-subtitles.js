!function t(e,n,r){function s(o,a){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return s(n||t)},c,c.exports,t,e,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(t,e,n){(function(t){function e(t,e){for(var n=0,r=t.length-1;r>=0;r--){var s=t[r];"."===s?t.splice(r,1):".."===s?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(t){return r.exec(t).slice(1)};n.resolve=function(){for(var n="",r=!1,s=arguments.length-1;s>=-1&&!r;s--){var o=s>=0?arguments[s]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(n=o+"/"+n,r="/"===o.charAt(0))}return n=e(i(n.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+n||"."},n.normalize=function(t){var r=n.isAbsolute(t),s="/"===o(t,-1);return(t=e(i(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&s&&(t+="/"),(r?"/":"")+t},n.isAbsolute=function(t){return"/"===t.charAt(0)},n.join=function(){var t=Array.prototype.slice.call(arguments,0);return n.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},n.relative=function(t,e){t=n.resolve(t).substr(1),e=n.resolve(e).substr(1);function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}for(var s=r(t.split("/")),i=r(e.split("/")),o=Math.min(s.length,i.length),a=o,l=0;l<o;l++)if(s[l]!==i[l]){a=l;break}var u=[];for(l=a;l<s.length;l++)u.push("..");return(u=u.concat(i.slice(a))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(t){var e=s(t),n=e[0],r=e[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},n.basename=function(t,e){var n=s(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},n.extname=function(t){return s(t)[3]};function i(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}var o="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,t("_process"))},{_process:2}],2:[function(t,e,n){var r,s,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{s="function"==typeof clearTimeout?clearTimeout:a}catch(t){s=a}}();function l(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}var u,c=[],p=!1,f=-1;function h(){p&&u&&(p=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!p){var t=l(h);p=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,p=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new g(t,e)),1!==c.length||p||l(d)};function g(t,e){this.fun=t,this.array=e}g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={};function m(){}i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],3:[function(t,e,n){r=this,s=function(){"use strict";const t=function(t=[]){this.push(...t)};(t.prototype=new Array).limit=1/0,t.prototype.clean=(({stack:t="\nStack not available for "+navigator.userAgent}={})=>t.split("\n").slice(1).filter(t=>t).filter(t=>!/^_____/.test(t)).filter(t=>!/^persistence./.test(t))),t.prototype.add=function(t){return this.push(Object.assign({},t,{timestamp:(new Date).getTime(),stack:this.clean(new Error,"length"===t.key)},t)),this.length>this.limit&&this.splice(this.length-this.limit),this},t.prototype.type=function(e){return new t(this.filter(t=>t.type===e))},t.prototype.key=function(e){return new t(this.filter(t=>{const n=e.split(".").length;return t.key.split(".").slice(0,n).join(".")===e}))},t.prototype.latest=function(e=1/0){return new t(this.filter(t=>(new Date).getTime()-t.timestamp<e))};var e=new t;const n={},r=()=>"undefined"!=typeof window&&"localStorage"in window;n.load=(t=>{if(!r())return;const e=JSON.parse(localStorage.getItem("_____state")||"{}");if(e.data)for(let n in e.data)t[n]=e.data[n]}),n.save=(t=>{if(!r())return;const e=(new Date).getTime(),n=JSON.stringify({timestamp:e,data:t});localStorage.setItem("_____state",n)});const s={},i=["boolean","number","null","undefined","string"],o=(t=[])=>(n,r)=>{if("symbol"==typeof r)return n[r];if("_____history"===r)return e;if("_____listeners"===r)return s;const i=[...t.map(t=>t.property),r].join(".");if(r in n)return e.add({type:"read",key:i}),n[r];if(/^\$/.test(r)){const n=[...t.map(t=>t.property),r.slice(1)||"_____root"].join("."),i=n.split(".").reduce((t,e)=>t[e],u);return e.add({type:"listen",key:n}),s[n]=s[n]||[],(t,e)=>(s[n].push(t),t.setState?t:t(i))}},a=(t=[])=>(r,c,p)=>{if(/^\$/.test(c))throw new Error("The keys that start by $ are reserved and should not be set manually.");if(/^\_\_/.test(c))throw new Error("The keys that start by __ (two underscores) are reserved and should not be set manually.");const f=[...t.map(t=>t.property),c].join("."),h=void 0===r[c]?"create":"update";e.add({type:h,key:f,value:p}),r[c]=p,n.save(u);const d=(t,e)=>{if(i.includes(typeof t)||null===t)return t;if(Array.isArray(t)&&(t=t.map((t,n,r)=>d(t,[...e,{target:r,property:n,value:t}]))),/^\{/.test(JSON.stringify(t)))for(let n in t){const s={target:r,property:n,value:t[n]};t[n]=d(t[n],[...e,s])}return new Proxy(t,{get:o(e),set:a(e),deleteProperty:l(e)})};return r[c]=d(p,[...t,{target:r,property:c,value:p}]),[...t,{target:r,property:c,value:p}].forEach((t,e,n)=>{const r=n.slice(0,e+1).map(t=>t.property).join(".");if(s[r]){const t=r.split(".").reduce((t,e)=>t[e],u);s[r].forEach(e=>{if(e&&e.setState)return e.setState({__state:Math.random()});e(t)})}}),!s._____root||(s._____root.forEach(t=>{if(t&&t.setState)return t.setState({__state:Math.random()});t(u)}),!0)},l=(t=[])=>(r,i)=>{if(/^\$/.test(i))throw new Error("The keys that start by $ are reserved and should not be set manually.");if(/^\_\_/.test(i))throw new Error("The keys that start by __ (two underscores) are reserved and should not be set manually.");const o=[...t.map(t=>t.property),i].join(".");return e.add({type:"delete",key:o}),delete r[i],n.save(u),[...t,{target:r,property:i}].forEach((t,e,n)=>{const r=n.slice(0,e+1).map(t=>t.property).join(".");if(s[r]){const t=r.split(".").reduce((t,e)=>t[e],u);s[r].forEach(e=>e(t))}}),!s._____root||(s._____root.forEach(t=>{if(t&&t.setState)return t.setState({__state:Math.random()});t(u)}),!0)},u=new Proxy({},{get:o(),set:a(),deleteProperty:l()});return n.load(u),u},"object"==typeof n&&void 0!==e?e.exports=s():"function"==typeof define&&define.amd?define(s):r.state=s();var r,s},{}],4:[function(t,e,n){const r=t("./state");e.exports=(()=>{const t=[".epSubtitlesSearch",".epSubtitlesSearchPP",".epRedownloadSubtitle",".epSearch",".epRetry",".epManualSearch"],e=$("#manualSubtitleSearchModal"),n=r.config.subtitlesMulti,s="images/loading32"+r.components.themeSpinner+".gif";let i,o;const a=()=>{$.each(t,(t,e)=>{$(e).css({"pointer-events":"none"})})},l=()=>{$.each(t,(t,e)=>{$(e).css({"pointer-events":"auto"})})},u=(t,e,n,r,s,i)=>{!0===i&&t.find("img").remove(),t.append($("<img/>").prop({src:e,alt:n,title:r,width:16,height:s}))};e.on("hidden.bs.modal",()=>{l()}),$.ajaxEpSubtitlesSearch=function(){const t=()=>{a(),u(o,s,"loading","loading",16,!0);let t=o.prop("href");return t=t.replace("searchEpisodeSubtitles","manual_search_subtitles"),$.getJSON(t,t=>{const n=$("#subtitle_results tr").length;if(n>1)for(let t=n-1;t>0;t--)$("#subtitle_results tr").eq(t).remove();$("h4#manualSubtitleSearchModalTitle.modal-title").text(t.release),"success"===t.result&&$.each(t.subtitles,(t,n)=>{const r='<img src="images/subtitles/'+n.provider+'.png" width="16" height="16" style="vertical-align:middle;"/>',s='<img src="images/subtitles/flags/'+n.lang+'.png" width="16" height="11"/>';let i="";for(let t=0;t<n.missing_guess.length;t++){let e=n.missing_guess[t];i&&(i+=", "),i+=(e=e.charAt(0).toUpperCase()+e.slice(1)).replace(/(_[a-z])/g,t=>t.toUpperCase().replace("_"," "))}const o=n.filename.substring(0,99);let a=n.score;n.sub_score>=n.max_score&&(i="");let l="";n.sub_score>=n.min_score&&(l='<img src="images/save.png" width="16" height="16"/>');const u='<a href="#" id="pickSub" title="Download subtitle: '+n.filename+'" subtitleID="subtitleid-'+n.id+'">'+o+l+"</a>";a>10?a=10:a<0&&(a=0);const c='<tr style="font-size: 95%;"><td style="white-space:nowrap;">'+r+" "+n.provider+"</td><td>"+s+'</td><td title="'+n.sub_score+"/"+n.min_score+'"> '+a+'</td><td class="tvShow"> '+u+"</td><td>"+i+"</td></tr>";$("#subtitle_results").append(c),$(".modal-content").resizable({alsoResize:".modal-body"}),$(".modal-dialog").draggable({cancel:".text"}),e.modal("show")}),u(o,"images/closed_captioning.png","Search subtitles","Search subtitles",16,!0),l()}),!1};$(".epSubtitlesSearch").on("click",function(t){t.preventDefault(),o=$(this),i=o.parent().siblings(".col-subtitles"),$("#askmanualSubtitleSearchModal").modal("show")}),$(".epSubtitlesSearchPP").on("click",function(e){e.preventDefault(),o=$(this),i=o.parent().siblings(".col-search"),t()}),$(document).on("click","#pickSub",function(t){t.preventDefault();const r=$(this);u(r,s,"loading","loading",16,!0);let a=r.attr("subtitleID");a=a.replace("subtitleid-","");let l=o.prop("href");l=l.replace("searchEpisodeSubtitles","manual_search_subtitles"),l+="&picked_id="+encodeURIComponent(a),$.getJSON(l,t=>{if(!1===e.is(":visible")&&e.modal("show"),"success"===t.result){const e=t.subtitles;if(u(r,"images/yes16.png","subtitle saved","subtitle saved",16,!0),$("table#releasesPP").length>0)o.parent().parent().remove();else if(!0===n){const t=e;let n=!1;i.children().children().each(function(){-1!==$(this).attr("alt").indexOf(t)&&(n=!0)}),!1===n&&u(i,"images/subtitles/flags/"+e+".png",e,e,11,!1)}else u(i,"images/subtitles/flags/unknown.png",e,e,11,!1)}else u(r,"images/no16.png","subtitle not saved","subtitle not saved",16,!0)})}),$("#askmanualSubtitleSearchModal .btn").on("click",function(){"manual"===$(this).text().toLowerCase()?t():(()=>{a(),u(o,s,"loading","loading",16,!0);const t=o.prop("href");$.getJSON(t,t=>{if("success"===t.result.toLowerCase()){const e=t.subtitles.split(",");i.empty(),$.each(e,(t,n)=>{""!==n&&(t!==e.length-1?u(i,"",n,n,11,!0):u(i,"images/subtitles/flags/"+n+".png",n,n,11,!0))})}u(o,"images/closed_captioning.png","Search subtitles","Search subtitles",16,!0),l()})})()})},$.fn.ajaxEpMergeSubtitles=function(){$(".epMergeSubtitles").on("click",function(){const t=$(this);return u(t,s,"loading","loading",16,!0),$.getJSON($(this).attr("href"),()=>{t.remove()}),!1})},$.ajaxEpRedownloadSubtitle=function(){$(".epRedownloadSubtitle").on("click",function(t){t.preventDefault(),o=$(this),$("#confirmSubtitleReDownloadModal").modal("show")}),$("#confirmSubtitleReDownloadModal .btn.btn-success").on("click",()=>{(()=>{a();const t=o.prop("href"),e="Re-downloading subtitle",n="Re-downloaded subtitle failed",r="Re-downloaded subtitle succeeded";u(o,s,e,e,16,!0),$.getJSON(t,t=>{"success"===t.result.toLowerCase()&&t.new_subtitles.length>0?u(o,"images/save.png",r,r,16,!0):u(o,"images/no16.png",n,n,16,!0)}),l()})()})}})},{"./state":5}],5:[function(t,e,n){const r=t("path"),s=t("statux");s.config={},s.auth.apiRoot=s.auth.apiRoot||r.join(document.getElementsByTagName("base")[0].href,"/api/v2/"),s.auth.apiKey=s.auth.apiKey||document.getElementsByTagName("body")[0].getAttribute("api-key"),s.components={loading:"",themeSpinner:""},window.state=s,e.exports=s},{path:1,statux:3}]},{},[4]);
//# sourceMappingURL=ajax-episode-subtitles.js.map
